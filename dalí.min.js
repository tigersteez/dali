function Queue(){this._oldestIndex=1,this._newestIndex=1,this._storage={}}function Vector(e,t){this.x=e||0,this.y=t||0}function GameObject(e,t){this.GUID=dalí.identifier.generateObjID(this),this.gameComponents=new Array,this.transform={position:new Vector(e,t),orientation:0}}function Camera(e){"undefined"!=typeof e&&null!==e?GameObject.call(this,e.getX(),e.getY()):GameObject.call(this,0,0)}function Player(e,t,i){GameObject.call(this,e,t),"undefined"!=typeof i&&null!==i?this.camera=i:(this.camera=new Camera(this),dalí.room.addObj(this.camera))}function GameComponent(e){this.gameObj=e,this.GUID=dalí.identifier.generateComponentID(this)}function Collider(e,t){GameComponent.call(this,e),this.imgData=null,this.isSolid=t}function Mover(e,t,i,o,a,n){Collider.call(this,e,t),this.velocity=new Vector(i||0,o||0),this.acceler=new Vector(a||0,n||0)}function SpriteMap(e){this.numFrames=e.numFrames||1,this.numRows=e.numRows||1,this.numCols=e.numCols||1,this.width=e.width,this.height=e.height,this.img=dalí.resources.getImg(e.imgurl),this.offsetX=e.offsetX||0,this.offsetY=e.offsetY||0,this.spriteWidth=this.width/this.numCols,this.spriteHeight=this.height/this.numRows}function FontMap(e){SpriteMap.call(this,e),this.mapCharToIdx=e.mapCharToIdx||function(e){return e.charCodeAt(0)}}function Texture(e){this.imgurl=e,this.texture=dalí.main.createPattern(dalí.resources.getImg(e),"repeat")}function Renderer(e,t){GameComponent.call(this,e),this.width=t.width||1,this.height=t.height||1,this.scaleRatio=t.scaleRatio||1}function SpriteRenderer(e,t){Renderer.call(this,e,t),this.spriteMap=dalí.resources.getSprite(t.spriteurl),this.width=this.spriteMap.spriteWidth,this.height=this.spriteMap.spriteHeight}function ParticleRenderer(e,t){Renderer.call(this,e,t),this.radius=this.width/2,this.fillColor=t.color}function BoxRenderer(e,t){Renderer.call(this,e,t),this.borderThickness=t.borderThickness||0,this.fillColor=t.color,this.borderColor=t.borderColor||"#000000"}function TextRenderer(e,t){Renderer.call(this,e,t),this.font=dalí.resources.getFont(t.fonturl),this.text=t.text,this.setDesiredLength(t.desiredLength),this.width=this.font.spriteWidth*this.text.length,this.height=this.font.spriteHeight}function TextureRenderer(e,t){Renderer.call(this,e,t),this.texture=dalí.resources.getTexture(t.textureurl),this.isBackground=t.isBackground||!0}function Animation(e,t){SpriteRenderer.call(this,e,t),this.frameIndex=0,this.tickCount=0,this.ticksPerFrame=t.ticksPerFrame||0,this.numberOfFrames=t.numFrames||1}function UI_Element(e,t,i){GameObject.call(this,e,t),this.x0=this.transform.position.x,this.y0=this.transform.position.y}function GameAudio(e,t,i){GameComponent.call(this,e),this.source=dalí.audio.ctx.createBufferSource(),this.source.buffer=dalí.resources.getAudioBuffer(t),this.source.loop=i,this.source._playing=!1,this.source.connect(dalí.audio.ctx.destination)}function ResourceLoader(e,t,i){this.resourceCache={},this.readyCallbacks=[],this.loadResource=e,this.manager=t,this.extraData=i||null}function ResourceManager(){function e(e,t){var i=new Image
i.onload=function(){if(t.resourceCache[e]=i,t.isReady())for(var o=0;o<t.readyCallbacks.length;o++)t.readyCallbacks[o](t.manager)},i.src=e,t.resourceCache[e]=!1}function t(e,t){var i=new XMLHttpRequest
i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){dalí.audio.ctx.decodeAudioData(i.response,function(i){t.resourceCache[e]=i},function(){console.log('Error decoding audio "'+e+'".')})},i.send(),t.resourceCache[e]=!1}function i(e,t){t.resourceCache[e]=new Texture(e)}function o(e,t){t.resourceCache[e]=new SpriteMap(t.extraData[e])}function a(e,t){t.resourceCache[e]=new FontMap(t.extraData[e])}function n(e){e.textures.load(e.resources.textures),e.fonts.extraData=e.resources.fonts.details,e.fonts.load(e.resources.fonts.urls),e.sprites.extraData=e.resources.sprites.details,e.sprites.load(e.resources.sprites.urls)}this.imgs=new ResourceLoader(e,this),this.fonts=new ResourceLoader(a,this),this.sprites=new ResourceLoader(o,this),this.textures=new ResourceLoader(i,this),this.audio=new ResourceLoader(t,this),this.loadImgs=function(){var e=[]
e=e.concat(this.resources.textures,this.resources.fonts.urls,this.resources.sprites.urls),this.imgs.onReady(n),this.imgs.load(e)},this.loadAudioBuffers=function(){this.audio.load(this.resources.audio)}}function Room(){this.loadingObjs={},this.objects={},this.colliders=[],this.movers=[],this.players=[],this.toBeRemoved=new Queue,this.mainCamera=null,this.cameras=[]}function removeNum(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function EventHandler(e,t){this.eventTypes=e,this.myGUID=t||dalí.identifier.generateObjID(this),this.registerForEvents()}function Timeline(){}function Rotator(e,t){GameComponent.call(this,e),this.speed=t}function Ball(e,t,i,o,a,n,s,r){GameObject.call(this,e,t),EventHandler.call(this,[dalí.physics.collisionEvent],this.GUID),this.gameComponents.push(new SpriteRenderer(this,{width:BALL_LENGTH,height:BALL_LENGTH,scaleRatio:2*i/BALL_LENGTH,spriteurl:BALL_URL})),this.gameComponents.push(new Mover(this,!0,o,a,n||1,s||1)),this.addComp(new GameAudio(this,"./audio/whoosh.wav",!1)),this.addComp(new Rotator(this,r||16))}function Wall(e,t,i,o){GameObject.call(this,e,t),this.gameComponents.push(new TextureRenderer(this,{width:i,height:o,isBackground:!1,textureurl:BRICK_URL})),this.gameComponents.push(new Collider(this,!0))}function Score(e,t,i){UI_Element.call(this,e,t,i),this.score=0,i.textRender.text=this.score.toString(),this.gameComponents.push(new SpriteRenderer(this,i.spriteRender)),this.gameComponents.push(new TextRenderer(this,i.textRender))}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e))+e}function BallMaker(e,t,i){GameComponent.call(this,e),this.score=t,this.time=0,this.proxyBot=i}function ProxyController(e){GameComponent.call(this,e)}function Health(e,t,i){UI_Element.call(this,e,t,i),this.health=3,this.oldHealth=this.health,this.makeString(),i.text="Lives: "+this.str,this.gameComponents.push(new TextRenderer(this,i)),this.scaleRatio=this.gameComponents[0].scaleRatio}function ProxyBot(e,t,i,o,a){Player.call(this,e,t,a),EventHandler.call(this,[dalí.physics.collisionEvent],this.GUID),this.gameComponents.push(new Mover(this,!0)),this.gameComponents.push(new ProxyController(this)),this.gameComponents.push(new Animation(this,{scaleRatio:SPRITE_SCALE,spriteurl:SPRITE_URL,numFrames:NUM_SPRITES,ticksPerFrame:32})),this.health=i,this.score=o}function CameraMover(e){GameComponent.call(this,e),this.dx=0,this.dy=0}function init(){var e=new Health(5,5,{fonturl:FONT_URL,desiredLength:200})
score=new Score(5,dalí.canvas.height-25,{textRender:{fonturl:FONT_URL,desiredLength:20},spriteRender:{width:BALL_LENGTH,height:BALL_LENGTH,scaleRatio:BALL_SCALE,spriteurl:BALL_URL}})
var t=new ProxyBot(100,100,e,score,dalí.room.mainCamera),i=new Wall(0,0,dalí.canvas.width,25),o=new GameObject(0,0),a=new TextureRenderer(o,{textureurl:STONE_URL,width:dalí.canvas.width,height:dalí.canvas.height,isBackground:!0})
o.gameComponents.push(a),o.addComp(new GameAudio(o,"./audio/med.wav",!0)),o.getAudio().play(),dalí.room.addObj(o),dalí.room.addObj(t)
var n=new GameObject(0,0)
n.gameComponents.push(new BallMaker(n,score,t)),dalí.room.addObj(n),n.gameComponents[0].generateBall(),n.gameComponents[0].generateBall(),n.gameComponents[0].generateBall(),dalí.room.addObj(e),dalí.room.addObj(score),dalí.room.addObj(i),i=new Wall(0,0,25,dalí.canvas.height),dalí.room.addObj(i),i=new Wall(0,dalí.canvas.height-25,dalí.canvas.width,25),dalí.room.addObj(i),i=new Wall(dalí.canvas.width-25,0,25,dalí.canvas.height),dalí.room.addObj(i)
var s=new GameObject(dalí.canvas.width-205,5)
s.gameComponents.push(new TextRenderer(s,{fonturl:FONT_URL,text:"Ball Game!",desiredLength:200})),dalí.room.addObj(s)}function gameLoop(){if(requestAnimationFrame(gameLoop),loop)dalí.checkQuit(),dalí.room.loop()
else if(firstLoop)dalí.room.deleteLoading(),init(),loop=!0,firstLoop=!1
else if(dalí.resources.updateState(),dalí.resources.preloaders.isReady()){if(firstLoad){var e=new Camera
e.gameComponents.push(new CameraMover(e)),dalí.room.addObj(e)
var t=new GameObject(dalí.canvas.width/2-200,50)
t.addComp(new TextRenderer(t,{fonturl:FONT_URL,text:"Loading...",desiredLength:400})),dalí.room.addLoadingObj(t),firstLoad=!1}dalí.room.drawLoading()}}var dalí={}
dalí.canvas=document.getElementById("myCanvas"),dalí.main=dalí.canvas.getContext("2d")
var canvas=document.createElement("canvas")
canvas.width=dalí.canvas.width,canvas.height=dalí.canvas.height,dalí.fg=canvas.getContext("2d"),function(){function e(e,t){t=t||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
for(var i="",o=0;e>o;o++){var a=Math.floor(Math.random()*t.length)
i+=t.substring(a,a+1)}return i}function t(){return s}function i(e){return e.constructor.name+"::"+dalí.identifier.getClientID()+"::"+dalí.identifier.randomString(7)}function o(e){return e.gameObj.GUID+"::"+e.constructor.name+"::"+dalí.identifier.randomString(4)}function a(e){var t=e.split("::")
this.objClass=t[0],this.clientID=t[1],this.objID=t[2],5==t.length?(this.compClass=t[3],this.compID=t[4]):(this.compClass=null,this.compID=null)}function n(e){return new a(e)}var s=e(25)
a.prototype.getObjID=function(){return this.objClass+"::"+this.clientID+"::"+this.objID},a.prototype.getCompID=function(){return null!==this.compID?this.getObjID()+"::"+this.compClass+"::"+this.compID:null},window.dalí.identifier={randomString:e,getClientID:t,generateObjID:i,generateComponentID:o,getDataFromGUID:n}}(),function(){function e(){var e=Date.now()
o=(e-(i||e))/1e3,i=e}function t(){return o}var i=null,o=0
window.dalí.time={getDeltaTime:t,updateDeltaTime:e}}(),dalí.extend=function(e,t){var i=t.prototype
t.prototype=Object.create(e.prototype)
for(var o in i)t.prototype[o]=i[o]
t.prototype.constructor=t,Object.defineProperty(t.prototype,"constructor",{enumerable:!1,value:t})},function(){for(var e=0,t=["ms","moz","webkit","o",""],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"]
window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){var o=(new Date).getTime(),a=Math.max(0,16-(o-e)),n=window.setTimeout(function(){t(o+a)},a)
return e=o+a,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),Array.prototype.contains=function(e){return this.indexOf(e)>-1},String.prototype.hashCode=function(){var e,t,i,o=0
if(0===this.length)return o
for(e=0,i=this.length;i>e;e++)t=this.charCodeAt(e),o=(o<<5)-o+t,o|=0
return o},Queue.prototype.size=function(){return this._newestIndex-this._oldestIndex},Queue.prototype.enqueue=function(e){this._storage[this._newestIndex]=e,this._newestIndex++},Queue.prototype.dequeue=function(){var e,t=this._oldestIndex,i=this._newestIndex
return t!==i?(e=this._storage[t],delete this._storage[t],this._oldestIndex++,e):void 0},Queue.prototype.isEmpty=function(){return this._oldestIndex===this._newestIndex},Queue.prototype.emptyQueue=function(e){for(;!this.isEmpty();)e(this.dequeue())},function(){function e(e,i){var o,a=e.keyCode
switch(a){case 32:o="SPACE"
break
case 37:o="LEFT"
break
case 38:o="UP"
break
case 39:o="RIGHT"
break
case 40:o="DOWN"
break
default:o=String.fromCharCode(a)}t[o]=i}var t={}
document.addEventListener("keydown",function(t){e(t,!0)}),document.addEventListener("keyup",function(t){e(t,!1)}),window.addEventListener("blur",function(){t={}}),window.dalí.input={keys:{isDown:function(e){return t[e.toUpperCase()]}}}}(),Vector.mult=function(e,t){return new Vector(e.x*t,e.y*t)},Vector.add=function(e,t){var i=new Vector(e.x,e.y)
return i.x+=t.x,i.y+=t.y,i},GameObject.prototype.addComp=function(e){this.gameComponents.push(e)},GameObject.prototype.update=function(){this.gameComponents.forEach(function(e){e instanceof GameComponent&&e.update()})},GameObject.prototype.getX=function(){return this.transform.position.x},GameObject.prototype.getY=function(){return this.transform.position.y},GameObject.prototype.getPosition=function(){return this.transform.position},dalí.extend(GameObject,Camera),dalí.extend(GameObject,Player),GameObject.prototype.readHID=function(){this.gameComponents.forEach(function(e){e instanceof GameComponent&&e.readHID()})},GameComponent.prototype.update=function(){},GameComponent.prototype.draw=function(){},GameComponent.prototype.readHID=function(){},dalí.extend(GameComponent,Collider),GameObject.prototype.getCollider=function(){for(var e in this.gameComponents)if(this.gameComponents[e]instanceof Collider)return this.gameComponents[e]
return null},Mover.prototype.update=function(){this.velocity=Vector.add(this.velocity,Vector.mult(this.acceler,dalí.time.getDeltaTime())),this.gameObj.transform.position=Vector.add(this.gameObj.transform.position,Vector.mult(this.velocity,dalí.time.getDeltaTime()))},Mover.prototype.resetSpeeds=function(){this.velocity.x=0,this.velocity.y=0},Mover.prototype.resetAccs=function(){this.acceler.x=0,this.acceler.y=0},Mover.prototype.reset=function(){this.resetSpeeds(),this.resetAccs()},dalí.extend(Collider,Mover),SpriteMap.prototype.render=function(e,t,i){dalí.main.drawImage(this.img,t*this.spriteWidth+this.offsetY,e*this.spriteHeight+this.offsetX,this.spriteWidth,this.spriteHeight,0,0,this.spriteWidth*i,this.spriteHeight*i),dalí.fg.drawImage(this.img,t*this.spriteWidth+this.offsetY,e*this.spriteHeight+this.offsetX,this.spriteWidth,this.spriteHeight,0,0,this.spriteWidth*i,this.spriteHeight*i)},SpriteMap.prototype.draw=function(e,t,i,o,a,n){var s=dalí.room.mainCamera.getPosition()
dalí.fg.save(),dalí.main.save(),dalí.fg.translate(e,t),dalí.fg.translate(this.spriteWidth*a/2,this.spriteHeight*a/2),dalí.fg.rotate(n),dalí.fg.translate(-this.spriteWidth*a/2,-this.spriteHeight*a/2),dalí.main.translate(e-s.x,t-s.y),dalí.main.translate(this.spriteWidth*a/2,this.spriteHeight*a/2),dalí.main.rotate(n),dalí.main.translate(-this.spriteWidth*a/2,-this.spriteHeight*a/2),this.render(i,o,a),dalí.fg.restore(),dalí.main.restore()},SpriteMap.prototype.getMapIndices=function(e){return{i:Math.floor(e/this.numCols),j:e%this.numCols}},FontMap.prototype.draw=function(e,t,i,o,a){var n=this.getMapIndices(this.mapCharToIdx(i))
SpriteMap.prototype.draw.call(this,e,t,n.i,n.j,o,a)},dalí.extend(SpriteMap,FontMap),Texture.prototype.render=function(e,t,i,o,a){var n=dalí.room.mainCamera.getPosition()
dalí.main.fillStyle=this.texture,dalí.main.fillRect(e-n.x,t-n.y,i,o),a||(dalí.fg.fillStyle=this.texture,dalí.fg.fillRect(e,t,i,o))},Renderer.prototype.draw=function(){this.render()
var e=this.gameObj.getCollider()
null!==e&&(e.imgData=dalí.fg.getImageData(this.gameObj.getX(),this.gameObj.getY(),this.width*this.scaleRatio,this.height*this.scaleRatio))},Renderer.prototype.render=function(){},dalí.extend(GameComponent,Renderer),function(){function e(e){if(e.gameObj instanceof UI_Element||e instanceof TextRenderer)n.enqueue(e)
else{var t=e.gameObj.getCollider()
null!==t?t instanceof Mover?o.enqueue(e):a.enqueue(e):i.enqueue(e)}}function t(){i.emptyQueue(s),o.emptyQueue(s),a.emptyQueue(s),n.emptyQueue(s)}var i=new Queue,o=new Queue,a=new Queue,n=new Queue,s=function(e){e.draw()}
window.dalí.drawing={draw:t,queue:e}}(),GameObject.prototype.getRenderer=function(){for(var e in this.gameComponents)if(this.gameComponents[e]instanceof Renderer)return this.gameComponents[e]
return null},GameObject.prototype.draw=function(){this.gameComponents.forEach(function(e){e instanceof Renderer&&dalí.drawing.queue(e)})},SpriteRenderer.prototype.getMapIndices=function(){return{i:0,j:0}},SpriteRenderer.prototype.render=function(){var e=this.getMapIndices()
this.spriteMap.draw(this.gameObj.getX(),this.gameObj.getY(),e.i,e.j,this.scaleRatio,this.gameObj.transform.orientation)},dalí.extend(Renderer,SpriteRenderer),ParticleRenderer.prototype.render=function(){var e=dalí.room.mainCamera.getPosition(),t=this.gameObj.getX()-e.x,i=this.gameObj.getY()-e.y
dalí.fg.beginPath(),dalí.fg.arc(this.gameObj.getX()+this.scaleRatio*this.radius,this.gameObj.getY()+this.scaleRatio*this.radius,this.scaleRatio*this.radius,0,2*Math.PI),dalí.fg.fillStyle=this.fillColor,dalí.fg.fill(),dalí.fg.closePath(),dalí.main.beginPath(),dalí.main.arc(t+this.scaleRatio*this.radius,i+this.scaleRatio*this.radius,this.scaleRatio*this.radius,0,2*Math.PI),dalí.main.fillStyle=this.fillColor,dalí.main.fill(),dalí.main.closePath()},dalí.extend(Renderer,ParticleRenderer),BoxRenderer.prototype.render=function(){var e=dalí.room.mainCamera.getPosition(),t=this.gameObj.getX()-e.x,i=this.gameObj.getY()-e.y
dalí.fg.beginPath(),dalí.fg.fillStyle=this.fillColor,dalí.fg.fillRect(this.gameObj.getX(),this.gameObj.getY(),this.width,this.height),dalí.main.beginPath(),dalí.main.fillStyle=this.fillColor,dalí.main.fillRect(t,i,this.width,this.height),0!=this.borderThickness&&(dalí.fg.strokeStyle=this.borderColor,dalí.fg.lineWidth=this.borderThickness,dalí.fg.strokeRect(this.gameObj.getX(),this.gameObj.getY(),this.width,this.height),dalí.main.strokeStyle=this.borderColor,dalí.main.lineWidth=this.borderThickness,dalí.main.strokeRect(t,i,this.width,this.height)),dalí.fg.closePath(),dalí.main.closePath()},dalí.extend(Renderer,BoxRenderer),TextRenderer.prototype.render=function(){for(var e=0;e<this.text.length;e++)this.font.draw(this.gameObj.getX()+this.font.spriteWidth*this.scaleRatio*e,this.gameObj.getY(),this.text.charAt(e),this.scaleRatio,this.gameObj.transform.orientation)},TextRenderer.prototype.setText=function(e,t){"undefined"==typeof t||null===t?(this.resize(e),this.text=e):(this.text=e,this.setDesiredLength(t))},TextRenderer.prototype.resize=function(e){this.desiredLength+=(e.length-this.text.length)*(this.font.spriteWidth*this.scaleRatio)},TextRenderer.prototype.setDesiredLength=function(e){this.desiredLength=e,this.scaleRatio=e/(this.font.spriteWidth*this.text.length)},dalí.extend(Renderer,TextRenderer),TextureRenderer.prototype.render=function(){this.texture.render(this.gameObj.getX(),this.gameObj.getY(),this.width*this.scaleRatio,this.height*this.scaleRatio,this.isBackground)},dalí.extend(Renderer,TextureRenderer),Animation.prototype.update=function(){this.tickCount+=1,this.tickCount>this.ticksPerFrame&&(this.tickCount=0,this.frameIndex<this.numberOfFrames-1?this.frameIndex+=1:this.frameIndex=0)},Animation.prototype.getMapIndices=function(){return this.spriteMap.getMapIndices(this.frameIndex)},dalí.extend(SpriteRenderer,Animation),UI_Element.prototype.draw=function(){for(var e=0;e<this.gameComponents.length;e++)dalí.drawing.queue(this.gameComponents[e]),this.transform.position.x+=this.gameComponents[e].width*this.gameComponents[e].scaleRatio
this.transform.position.x=this.x0},dalí.extend(GameObject,UI_Element),dalí.audio={},dalí.audio.ctx=null
try{window.AudioContext=window.AudioContext||window.webkitAudioContext,dalí.audio.ctx=new window.AudioContext}catch(e){alert("Web Audio API not supported in this browser.")}GameAudio.prototype.play=function(){this.source._playing||(this.source.start(dalí.audio.ctx.currentTime),this.source._playing=!0)},GameAudio.prototype.stop=function(){this.source._playing&&(this.source.stop(),this.source._playing=!1)},dalí.extend(GameComponent,GameAudio),GameObject.prototype.getAudio=function(){for(var e in this.gameComponents)if(this.gameComponents[e]instanceof GameAudio)return this.gameComponents[e]
return null},ResourceLoader.prototype.load=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++)this._load(e[t])
else this._load(e)
if(this.isReady())for(var t=0;t<this.readyCallbacks.length;t++)this.readyCallbacks[t](this.manager)},ResourceLoader.prototype._load=function(e){return this.resourceCache[e]?this.resourceCache[e]:void this.loadResource(e,this)},ResourceLoader.prototype.get=function(e){return this.resourceCache[e]},ResourceLoader.prototype.isReady=function(){var e=!0
for(var t in this.resourceCache)this.resourceCache.hasOwnProperty(t)&&!this.resourceCache[t]&&(e=!1)
return e},ResourceLoader.prototype.onReady=function(e){this.readyCallbacks.push(e)},ResourceManager.prototype.isReady=function(){return this.imgs.isReady()&&this.textures.isReady()&&this.fonts.isReady()&&this.sprites.isReady()&&this.audio.isReady()},ResourceManager.prototype.load=function(e){this.resources=e,this.loadImgs(),this.loadAudioBuffers()},ResourceManager.prototype.toString=function(){return"ResourceManager"},function(){function e(){console.log("Updating load state..."+r)
r.hashCode()==="preloading".hashCode()&&window.dalí.resources.preloaders.isReady()?r="gameloading":r.hashCode()==="gameloading".hashCode()&&window.dalí.resources.gameloaders.isReady()?r="levelpreloading":r.hashCode()==="levelpreloading".hashCode()&&window.dalí.resources.levelloaders.preloaders.isReady()?r="levelloading":r.hashCode()==="levelloading".hashCode()&&window.dalí.resources.levelloaders.manager.isReady()&&(window.firstLoop=!0,r="preloading")}function t(){return r}function i(e){return window.dalí.resources.levelloaders.manager.imgs.get(e)||window.dalí.resources.preloaders.imgs.get(e)||window.dalí.resources.gameloaders.imgs.get(e)||window.dalí.resources.levelloaders.preloaders.imgs.get(e)}function o(e){return window.dalí.resources.levelloaders.manager.textures.get(e)||window.dalí.resources.preloaders.textures.get(e)||window.dalí.resources.gameloaders.textures.get(e)||window.dalí.resources.levelloaders.preloaders.textures.get(e)}function a(e){return window.dalí.resources.levelloaders.manager.fonts.get(e)||window.dalí.resources.preloaders.fonts.get(e)||window.dalí.resources.gameloaders.fonts.get(e)||window.dalí.resources.levelloaders.preloaders.fonts.get(e)}function n(e){return window.dalí.resources.levelloaders.manager.sprites.get(e)||window.dalí.resources.preloaders.sprites.get(e)||window.dalí.resources.gameloaders.sprites.get(e)||window.dalí.resources.levelloaders.preloaders.sprites.get(e)}function s(e){return window.dalí.resources.levelloaders.manager.audio.get(e)||window.dalí.resources.preloaders.audio.get(e)||window.dalí.resources.gameloaders.audio.get(e)||window.dalí.resources.levelloaders.preloaders.audio.get(e)}var r="preloading"
window.dalí.resources={preloaders:new ResourceManager,gameloaders:new ResourceManager,levelloaders:{preloaders:new ResourceManager,manager:new ResourceManager},updateState:e,getGameState:t,getImg:i,getTexture:o,getFont:a,getSprite:n,getAudioBuffer:s}}()
const BALL_URL="./img/blue_orb.png",SPRITE_URL="./img/proxyBot.png",STONE_URL="./img/stone_texture.png",BRICK_URL="./img/brick.png"
Room.prototype.addLoadingObj=function(e){e instanceof GameObject&&(this.loadingObjs[e.GUID]=e)},Room.prototype.addObj=function(e){if(e instanceof GameObject){this.objects[e.GUID]=e,e instanceof Player&&this.players.push(e.GUID)
var t=e.getCollider()
null!==t&&(t instanceof Mover?this.movers.push(e.GUID):this.colliders.push(e.GUID)),e instanceof Camera&&(this.cameras.push(e.GUID),null===this.mainCamera&&(this.mainCamera=e))}},Room.prototype.removeObj=function(e){this.toBeRemoved.enqueue(e)},Room.prototype.removeObjects=function(){for(;!this.toBeRemoved.isEmpty();)this.remove(this.toBeRemoved.dequeue())},Room.prototype.remove=function(e){removeNum(this.colliders,e),removeNum(this.movers,e),removeNum(this.players,e),delete this.objects[e]},Room.prototype.readHID=function(){for(var e in this.objects)(this.objects[e]instanceof Player||this.objects[e]instanceof Camera)&&this.objects[e].readHID()},Room.prototype.draw=function(){dalí.main.clearRect(0,0,dalí.canvas.width,dalí.canvas.height),dalí.fg.clearRect(0,0,dalí.canvas.width,dalí.canvas.height)
for(var e in this.objects)this.objects[e]instanceof GameObject&&this.objects[e].draw()
dalí.drawing.draw()},Room.prototype.update=function(){for(var e in this.objects)this.objects[e]instanceof GameObject&&this.objects[e].update()},Room.prototype.getObj=function(e){return e in this.objects?this.objects[e]:null},Room.prototype.getPlayer=function(e){return this.players.contains(e)?this.getObj(e):null},Room.prototype.getCollider=function(e){if(this.colliders.contains(e)){var t=this.getObj(e)
if(null!==t)return t.getCollider()}return null},Room.prototype.getMover=function(e){if(this.movers.contains(e)){var t=this.getObj(e)
if(null!==t)return t.getCollider()}return null},Room.prototype.loop=function(){dalí.events.emptyQueue(),this.readHID(),dalí.time.updateDeltaTime(),this.update(),dalí.events.emptyQueue(),this.removeObjects(),this.draw(),dalí.physics.checkCollisions(this)},Room.prototype.drawLoading=function(){dalí.main.clearRect(0,0,dalí.canvas.width,dalí.canvas.height),dalí.fg.clearRect(0,0,dalí.canvas.width,dalí.canvas.height),dalí.main.fillStyle="#000",dalí.main.fillRect(0,0,dalí.canvas.width,dalí.canvas.height)
for(var e in this.loadingObjs)this.loadingObjs[e]instanceof GameObject&&this.loadingObjs[e].draw()
dalí.drawing.draw()},Room.prototype.deleteLoading=function(){delete loadingObjs},function(){function e(e,t){e in a||(a[e]=t)}function t(e,t){e in a&&a[e].handleEvent(t)}function i(e,t,i){n.enqueue({handle:e+"::"+t,data:i})}function o(){n.emptyQueue(function(e){t(e.handle,e.data)})}var a={},n=new Queue
window.dalí.events={registerHandler:e,notifyHandler:t,queueEvent:i,emptyQueue:o}}(),EventHandler.prototype.registerForEvents=function(){for(var e=null,t=0;t<this.eventTypes.length;t++)e=this.eventTypes[t]+"::"+this.myGUID,dalí.events.registerHandler(e,this)},EventHandler.prototype.handleEvent=function(e){"undefined"!=typeof this["on"+e.eventType]&&null!==this["on"+e.eventType]&&this["on"+e.eventType](e)},dalí.physics={},dalí.physics.collisionEvent="gamecollision",dalí.physics.raiseCollision=function(e){document.dispatchEvent(new CustomEvent(dalí.physics.collisionEvent,{detail:e}))},dalí.physics.testForCollision=function(e,t){dalí.room.mainCamera.getPosition()
if(dalí.physics.isPixelCollision(e.imgData,e.gameObj.getX(),e.gameObj.getY(),t.imgData,t.gameObj.getX(),t.gameObj.getY())){var i={eventType:dalí.physics.collisionEvent,GUID1:e.GUID,GUID2:t.GUID,collInfo:{}}
e.isSolid&&t.isSolid&&dalí.physics.resolveCollision(e,t,i),dalí.physics.raiseCollision(i)}},dalí.physics.checkCollisions=function(e){for(var t=0;t<e.movers.length;t++){for(var i=t+1;i<e.movers.length;i++)dalí.physics.testForCollision(e.getMover(e.movers[t]),e.getMover(e.movers[i]))
for(var o=0;o<e.colliders.length;o++)dalí.physics.testForCollision(e.getMover(e.movers[t]),e.getCollider(e.colliders[o]))}},document.addEventListener(dalí.physics.collisionEvent,function(e){var t=e.detail,i=dalí.identifier.getDataFromGUID(t.GUID1),o=dalí.identifier.getDataFromGUID(t.GUID2)
dalí.events.queueEvent(dalí.physics.collisionEvent,t.GUID1,t),dalí.events.queueEvent(dalí.physics.collisionEvent,i.getObjID(),t),dalí.events.queueEvent(dalí.physics.collisionEvent,t.GUID2,t),dalí.events.queueEvent(dalí.physics.collisionEvent,o.getObjID(),t)}),dalí.physics.resolveCollision=function(e,t,i){var o=null,a=null
e instanceof Mover&&t instanceof Mover?e.imgData.width*e.imgData.height<t.imgData.width*t.imgData.height?(o=t,a=e):(o=e,a=t):e instanceof Mover?(o=t,a=e):(o=e,a=t)
var n=a.gameObj.transform.position,s=o.gameObj.transform.position,r=o.imgData.height/o.imgData.width,l=1/r,d=!1,h=!1,c=!1,u=!1
if(a.velocity.x<=0){var m=(s.x+o.imgData.width-n.x)*r,p=s.y+m
m=s.y+o.imgData.height-m,u=n.x+a.imgData.width>s.x+o.imgData.width&&(n.y>=p||n.y+a.imgData.height<=m)}if(a.velocity.x>=0){var m=(n.x+a.imgData.width-s.x)*r,p=s.y+m
m=s.y+o.imgData.height-m,c=n.x<s.x&&(n.y>=p||n.y+a.imgData.height<=m)}if(u?n.x=s.x+o.imgData.width:c&&(n.x=s.x-a.imgData.width),a.velocity.y<=0){var g=(s.y+o.imgData.height-n.y)*l,f=s.x+o.imgData.width-g
g=s.x+g,d=n.y+a.imgData.height>s.y+o.imgData.height&&(n.x>=g||n.x+a.imgData.width<=f)}if(a.velocity.y>=0){var g=(n.y+a.imgData.height-s.y)*l,f=s.x+o.imgData.width-g
g=s.x+g,h=n.y<s.y&&(n.x>=g||n.x+a.imgData.width<=f)}d?n.y=s.y+o.imgData.height:h&&(n.y=s.y-a.imgData.height),i.collInfo[a.GUID]={top:d,bottom:h,left:u,right:c},i.collInfo[o.GUID]={top:h,bottom:d,left:c,right:u}},dalí.physics.isPixelCollision=function(e,t,i,o,a,n){if(null!==e&&null!==o){t=Math.round(t),i=Math.round(i),a=Math.round(a),n=Math.round(n)
var s=e.width,r=e.height,l=o.width,d=o.height,h=Math.max(t,a),c=Math.max(i,n),u=Math.min(t+s,a+l),m=Math.min(i+r,n+d)
if(h>=u||c>=m)return!1
var p=u-h,g=m-c,f=e.data,y=o.data
if(4>p&&4>g){for(var v=h;u>v;v++)for(var w=c;m>w;w++)if(0!==f[4*(v-t+(w-i)*s)+3]&&0!==y[4*(v-a+(w-n)*l)+3])return!0}else{var x=p/3,C=g/3
x=~~x===x?x:x+1|0,C=~~C===C?C:C+1|0
for(var R=0;C>R;R++)for(var b=0;x>b;b++)for(var w=c+R;m>w;w+=C)for(var v=h+b;u>v;v+=x)if(0!==f[4*(v-t+(w-i)*s)+3]&&0!==y[4*(v-a+(w-n)*l)+3])return!0}}return!1}
const max_dx=100,max_dy=100,max_a=2,MIN_R=3,MAX_R=10,MIN_O=12,MAX_O=36,BALL_LENGTH=216,BALL_SCALE=.05
Rotator.prototype.update=function(){this.gameObj.transform.orientation+=this.speed*dalí.time.getDeltaTime()},dalí.extend(GameComponent,Rotator),Ball.prototype.ongamecollision=function(e){var t=this.getCollider(),i=e.collInfo[t.GUID],o=null
o=e.GUID1.hashCode()===t.GUID.hashCode()?e.GUID2:e.GUID1
var a=dalí.identifier.getDataFromGUID(o)
a.objClass.hashCode()==="ProxyBot".hashCode()&&this.getAudio().play(),i.left&&t.velocity.x<0?(t.velocity.x=-t.velocity.x,t.acceler.x=-t.acceler.x):i.right&&t.velocity.x>0&&(t.velocity.x=-t.velocity.x,t.acceler.x=-t.acceler.x),i.top&&t.velocity.y<0?(t.velocity.y=-t.velocity.y,t.acceler.y=-t.acceler.y):i.bottom&&t.velocity.y>0&&(t.velocity.y=-t.velocity.y,t.acceler.y=-t.acceler.y)},dalí.extend(EventHandler,Ball),dalí.extend(GameObject,Ball),dalí.extend(GameObject,Wall),Score.prototype.updateText=function(){this.gameComponents[1].setText(this.score.toString())},Score.prototype.inc=function(e){this.score+=e||1,this.updateText()},Score.prototype.dec=function(e){this.score-=e||1,this.updateText()},dalí.extend(UI_Element,Score)
const ANOTHER_BALL=4,SPRITE_WIDTH=4096,SPRITE_HEIGHT=256,NUM_SPRITES=8,SPRITE_SCALE=.1,proxy_width=51.2,proxy_height=25.6,cushion=100
BallMaker.prototype.update=function(){this.time+=dalí.time.getDeltaTime(),this.time>=ANOTHER_BALL&&(this.generateBall(),this.time=0)},BallMaker.prototype.generateBall=function(){this.score.inc()
for(var e=getRandomInt(25,dalí.canvas.width-25),t=getRandomInt(25,dalí.canvas.height-25);e>=this.proxyBot.getX()-cushion&&e<=this.proxyBot.getX()+proxy_width+cushion&&t>=this.proxyBot.getY()-cushion&&t<=this.proxyBot.getY()+proxy_height+cushion;)e=getRandomInt(25,dalí.canvas.width-25),t=getRandomInt(25,dalí.canvas.height-25)
dalí.room.addObj(new Ball(e,t,getRandomInt(MIN_R,MAX_R),getRandomInt(-100,max_dx),getRandomInt(-100,max_dy),getRandomInt(-2,max_a),getRandomInt(-2,max_a),getRandomInt(MIN_O,MAX_O)))},dalí.extend(GameComponent,BallMaker),ProxyController.prototype.update=function(){this.gameObj.getCollider().reset()},ProxyController.prototype.readHID=function(){var e=this.gameObj.getCollider()
dalí.input.keys.isDown("LEFT")&&(e.velocity.x=-100),dalí.input.keys.isDown("RIGHT")&&(e.velocity.x=max_dx),dalí.input.keys.isDown("UP")&&(e.velocity.y=-100),dalí.input.keys.isDown("DOWN")&&(e.velocity.y=max_dy)},dalí.extend(GameComponent,ProxyController),Health.prototype.updateText=function(){this.makeString(),this.gameComponents[0].setText("Lives: "+this.str)},Health.prototype.makeString=function(){if(0===this.health)return dalí.gameOver()
this.str=""
for(var e=0;e<this.health;e++)this.str+="X"},Health.prototype.inc=function(e){this.oldHealth=this.health,this.health+=e||1,this.updateText()},Health.prototype.dec=function(e){this.oldHealth=this.health,this.health-=e||1,this.updateText()},dalí.extend(UI_Element,Health),ProxyBot.prototype.ongamecollision=function(e){var t=this.getCollider(),i=e.collInfo[t.GUID],o=null
o=e.GUID1.hashCode()===t.GUID.hashCode()?e.GUID2:e.GUID1
var a=dalí.identifier.getDataFromGUID(o),n=dalí.identifier.getDataFromGUID(this.GUID)
if("Wall".hashCode()==a.objClass.hashCode())(i.left||i.right)&&(t.velocity.x=0),(i.top||i.bottom)&&(t.velocity.y=0)
else{var s="<p>Collisions between "+a.objClass+" and "+n.objClass+"</p>"
console.log(s),this.health.dec(),this.score.dec(),dalí.room.removeObj(a.getObjID())}},dalí.extend(EventHandler,ProxyBot),dalí.extend(Player,ProxyBot),CameraMover.prototype.update=function(){this.gameObj.transform.position.x=this.gameObj.transform.position.x+this.dx*dalí.time.getDeltaTime(),this.gameObj.transform.position.y=this.gameObj.transform.position.y+this.dy*dalí.time.getDeltaTime(),this.dx=0,this.dy=0},CameraMover.prototype.readHID=function(){dalí.input.keys.isDown("A")&&(this.dx=-100),dalí.input.keys.isDown("D")&&(this.dx=max_dx),dalí.input.keys.isDown("W")&&(this.dy=-100),dalí.input.keys.isDown("S")&&(this.dy=max_dy)},dalí.extend(GameComponent,CameraMover)
const FONT_URL="./img/font.png"
var score=null
!function(){function e(){alert("GAME OVER\nYour score: "+score.score.toString()),document.location.reload()}function t(){dalí.input.keys.isDown("Q")?(console.log("Pressing Q"),0==i&&(i=1)):1==i&&(i=2),2==i&&(i=0,window.dalí.gameOver())}var i=0
window.dalí.checkQuit=t,window.dalí.gameOver=e}()
var loop=!1,firstLoop=!1,firstLoad=!0,myAssets=null
$.getJSON("./ballgame.json",function(e){myAssets=e
var t=new Room
dalí.room=t,dalí.resources.preloaders.load(myAssets.preloadResources),dalí.resources.gameloaders.load(myAssets.gameResources),dalí.resources.levelloaders.preloaders.load(myAssets.levelPreloadResources),dalí.resources.levelloaders.manager.load(myAssets.levelResources),gameLoop()})
